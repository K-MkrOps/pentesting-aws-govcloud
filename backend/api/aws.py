import boto3
from flask import Blueprint, jsonify

aws_bp = Blueprint('aws_bp', __name__)


@aws_bp.route('/api/aws/instances', methods=['GET'])
def get_aws_instances():
    """
    Endpoint for getting a list of AWS EC2 instances
    """
    ec2 = boto3.client('ec2')
    response = ec2.describe_instances()
    instance_data = []

    for reservation in response['Reservations']:
        for instance in reservation['Instances']:
            instance_data.append({
                'instance_id': instance['InstanceId'],
                'instance_type': instance['InstanceType'],
                'launch_time': instance['LaunchTime'].strftime('%Y-%m-%d %H:%M:%S')
            })

    return jsonify(instance_data)
